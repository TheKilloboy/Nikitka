<!DOCTYPE html><html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –ö–∞–∑–∏–Ω–æ –ù–∏–∫–∏—Ç–∫–∏ | DODEP Edition ‚Äî –£–ª—É—á—à–µ–Ω–æ</title>
    <style>
        :root{
            --bg-1: #1e3c72;
            --bg-2: #2a5298;
            --accent: #ffd700;
            --glass-1: rgba(255,255,255,0.03);
            --symbol-h: 140px; /* –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ –º–µ–¥–∏–∞–∑–∞–ø—Ä–æ—Å–∞—Ö */
            --slot-width: 100px;
            --reel-count: 7;
        }/* Dark / Light theme variables (will be toggled .light-theme on body) */
    body.light-theme{
        --bg-1: #f7fafc;
        --bg-2: #e2e8f0;
        --accent: #7e22ce;
        --glass-1: rgba(0,0,0,0.04);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
        font-family: Inter, 'Arial', sans-serif;
        background: linear-gradient(135deg,var(--bg-1),var(--bg-2));
        min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;overflow-x:hidden;color:#fff;
    }

    /* container */
    .casino-container{
        width:100%;max-width:980px;border-radius:24px;padding:32px;background:linear-gradient(145deg,#2d1b4e, #1a0f33);box-shadow:0 20px 80px rgba(0,0,0,0.5), inset 0 0 40px rgba(138,43,226,0.12);border:2px solid var(--accent);position:relative; z-index:10;
    }

    .header-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .title-block{display:flex;flex-direction:column}
    .casino-title{font-size:2.6rem;color:var(--accent);text-shadow:0 0 18px var(--accent);letter-spacing:1px}
    .casino-subtitle{color:#bfe7c4;font-size:0.95rem}

    /* theme toggle */
    .controls-top{display:flex;gap:10px;align-items:center}
    .btn,button{appearance:none;border:0;cursor:pointer;padding:10px 14px;border-radius:12px;background:var(--glass-1);color:inherit}
    .icon-btn{display:inline-flex;align-items:center;gap:8px}

    /* slot machine */
    .slot-machine{background:linear-gradient(145deg,#1a0f33,#0d0620);border-radius:16px;padding:20px;border:3px solid var(--accent);box-shadow:inset 0 0 30px rgba(138,43,226,0.35)}
    .slots-row{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;padding:12px}

    .slot{width:var(--slot-width);height:var(--symbol-h);background:linear-gradient(180deg,#111,#000);border-radius:12px;border:3px solid var(--accent);overflow:hidden;position:relative;box-shadow:inset 0 0 18px rgba(0,0,0,0.7);}
    .slot .viewport{position:relative;width:100%;height:100%;overflow:hidden}
    .slot-reel{position:absolute;left:0;top:0;transform:translateY(0);will-change:transform}
    .slot-symbol{display:flex;align-items:center;justify-content:center;height:var(--symbol-h);font-size:3.2rem;font-weight:800;color:var(--accent);text-shadow:0 0 12px var(--accent);background:linear-gradient(180deg,rgba(255,215,0,0.04),transparent)}

    .highlight{position:absolute;inset:0;border-radius:10px;pointer-events:none;border:3px solid transparent}
    .highlight.active{border-color:#4ade80;box-shadow:0 0 22px #4ade80,inset 0 0 12px rgba(74,222,128,0.2)}

    .bottom-controls{display:flex;align-items:center;justify-content:space-between;padding-top:18px;gap:12px}
    .spin-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
    .spin-button{padding:16px 44px;font-size:1.6rem;border-radius:999px;background:linear-gradient(145deg,#ff6b6b,#ee5a52);box-shadow:0 8px 20px rgba(255,107,107,0.25);color:#fff;font-weight:700}
    .spin-button:disabled{opacity:.6;cursor:not-allowed}

    .stats{display:flex;gap:12px;align-items:center}
    .stat{background:linear-gradient(145deg,rgba(255,215,0,0.06),rgba(255,215,0,0.02));padding:12px 16px;border-radius:10px;border:1px solid var(--accent);min-width:110px;text-align:center}
    .stat .label{font-size:0.75rem;color:#b2becd;text-transform:uppercase;letter-spacing:0.6px}
    .stat .value{font-size:1.5rem;font-weight:800;color:var(--accent)}

    .message{margin-top:12px;text-align:center;font-size:1.1rem;color:#a7f3d0;min-height:36px}

    /* overlay for jackpot */
    .win-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:999}
    .win-card{background:linear-gradient(145deg,var(--accent),#ffed4e);padding:36px;border-radius:18px;text-align:center;box-shadow:0 20px 80px rgba(0,0,0,0.6)}
    .win-card h2{font-size:2.4rem;color:#3b0761;margin-bottom:8px}
    .win-card p{font-size:1.1rem;color:#0f172a;margin-bottom:16px}

    /* fireworks container */
    .fireworks{position:fixed;inset:0;pointer-events:none;z-index:500}

    /* responsive */
    @media (max-width:900px){:root{--slot-width:84px;--symbol-h:120px}}
    @media (max-width:620px){:root{--slot-width:64px;--symbol-h:96px}.casino-title{font-size:1.4rem}}

    /* accessibility: prefer-reduced-motion */
    @media (prefers-reduced-motion: reduce){
        .slot-reel{transition:none!important;animation:none!important}
        .spin-button::before{display:none}
    }

</style>

</head>
<body>
    <div class="fireworks" id="fireworks" aria-hidden="true"></div><main class="casino-container" role="main">
    <div class="header-row">
        <div class="title-block">
            <h1 class="casino-title">üé∞ –ö–ê–ó–ò–ù–û –ù–ò–ö–ò–¢–ö–ò</h1>
            <div class="casino-subtitle">–°–æ–±–µ—Ä–∏ ¬´–ù–ò–ö–ò–¢–ö–ê¬ª ‚Äî —Å–æ–±–∏—Ä–∞–π –±—É–∫–≤—ã –∏ –ø–æ–±–µ–∂–¥–∞–π</div>
        </div>

        <div class="controls-top">
            <button class="btn icon-btn" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>
            <button class="btn" id="resetStats" title="–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É">‚ôª –°–±—Ä–æ—Å</button>
        </div>
    </div>

    <section class="slot-machine" aria-labelledby="slotTitle">
        <div id="slotTitle" class="sr-only" style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0 0 0 0);">–ò–≥—Ä–æ–≤–æ–π –∞–≤—Ç–æ–º–∞—Ç –ù–∏–∫–∏—Ç–∫–∏</div>

        <div class="slots-row" id="slotsRow" role="list" aria-label="–°–ª–æ—Ç—ã">
            <!-- 7 —Å–ª–æ—Ç–æ–≤ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>

        <div class="bottom-controls">
            <div class="spin-wrap">
                <button class="spin-button" id="spinButton" aria-pressed="false" aria-label="–ö—Ä—É—Ç–∏—Ç—å –±–∞—Ä–∞–±–∞–Ω—ã">üé≤ <span id="spinLabel">–ö–†–£–¢–ò–¢–¨</span></button>
                <div class="message" id="message">–ù–∞–∂–º–∏—Ç–µ ¬´–ö–†–£–¢–ò–¢–¨¬ª –∏–ª–∏ –ø—Ä–æ–±–µ–ª</div>
            </div>

            <div class="stats" aria-live="polite">
                <div class="stat"><div class="label">–ü–æ–ø—ã—Ç–æ–∫</div><div class="value" id="spins">0</div></div>
                <div class="stat"><div class="label">–ü–æ–±–µ–¥</div><div class="value" id="wins">0</div></div>
                <div class="stat"><div class="label">–ü—Ä–æ—Ü–µ–Ω—Ç</div><div class="value" id="percentage">0%</div></div>
            </div>
        </div>
    </section>

    <div class="win-overlay" id="winOverlay" role="dialog" aria-modal="true">
        <div class="win-card" role="document">
            <h2>üéâ –î–ñ–ï–ö–ü–û–¢! üéâ</h2>
            <p id="winText">–í—ã —Å–æ–±—Ä–∞–ª–∏ ¬´–ù–ò–ö–ò–¢–ö–ê¬ª ‚Äî –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</p>
            <div>
                <button class="btn" id="closeWin">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>
    </div>
</main>

<script>
    // ---- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ----
    const targetWord = ['–ù','–ò','–ö','–ò','–¢','–ö','–ê'];
    const alphabet = ['–ê','–ë','–í','–ì','–î','–ï','–ñ','–ó','–ò','–ô','–ö','–õ','–ú','–ù','–û','–ü','–†','–°','–¢','–£','–§','–•','–¶','–ß','–®','–©','–≠','–Æ','–Ø'];
    const REEL_COUNT = 7;
    const SYMBOLS_PER_REEL = 50;
    const BASE_WIN_CHANCE = 0.15; // –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞ –≤—ã–ø–∞—Å—Ç—å –Ω—É–∂–Ω–∞—è –±—É–∫–≤–∞

    let spins = 0;
    let wins = 0;
    let spinning = false;

    // localStorage key
    const STORAGE_KEY = 'nikitka_stats_v1';

    /* --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DOM --- */
    const slotsRow = document.getElementById('slotsRow');
    const spinButton = document.getElementById('spinButton');
    const messageEl = document.getElementById('message');
    const spinsEl = document.getElementById('spins');
    const winsEl = document.getElementById('wins');
    const percEl = document.getElementById('percentage');
    const winOverlay = document.getElementById('winOverlay');
    const closeWin = document.getElementById('closeWin');
    const fireworksContainer = document.getElementById('fireworks');
    const themeToggle = document.getElementById('themeToggle');
    const resetStats = document.getElementById('resetStats');

    // accessible: allow space key and Enter on button
    spinButton.addEventListener('keydown', (e)=>{ if(e.key==='Enter') spin(); });

    // Create slots markup
    function createSlots(){
        for(let i=0;i<REEL_COUNT;i++){
            const slot = document.createElement('div'); slot.className = 'slot'; slot.setAttribute('role','listitem');
            const viewport = document.createElement('div'); viewport.className = 'viewport';
            const reel = document.createElement('div'); reel.className = 'slot-reel'; reel.id = `reel${i}`;

            // populate symbols
            for(let j=0;j<SYMBOLS_PER_REEL;j++){
                const sym = document.createElement('div'); sym.className = 'slot-symbol';
                // choose random alphabet symbol
                sym.textContent = alphabet[Math.floor(Math.random()*alphabet.length)];
                reel.appendChild(sym);
            }

            viewport.appendChild(reel);
            const highlight = document.createElement('div'); highlight.className = 'highlight'; highlight.id = `highlight${i}`;
            slot.appendChild(viewport); slot.appendChild(highlight);
            slotsRow.appendChild(slot);
        }
    }

    // load saved stats
    function loadStats(){
        try{
            const raw = localStorage.getItem(STORAGE_KEY);
            if(raw){const s = JSON.parse(raw); spins=s.spins||0; wins=s.wins||0}
        }catch(e){/* ignore */}
        updateStatsUI();
    }

    function saveStats(){
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify({spins,wins})); }catch(e){}
    }

    function updateStatsUI(){
        spinsEl.textContent = spins;
        winsEl.textContent = wins;
        const percent = spins? ((wins/spins)*100).toFixed(1) : 0;
        percEl.textContent = percent + '%';
    }

    createSlots(); loadStats();

    // utility: get symbol height (computed) for precise animation
    function getSymbolHeight(){
        const slot = document.querySelector('.slot');
        return slot ? slot.getBoundingClientRect().height : 140;
    }

    // Spin logic returns final symbol for each reel
    function spinReel(index, duration){
        return new Promise((resolve)=>{
            const reel = document.getElementById(`reel${index}`);
            const symbols = Array.from(reel.children);
            const symbolHeight = getSymbolHeight();

            // Decide target: either correct letter or any other
            const wantWin = Math.random() < BASE_WIN_CHANCE;
            const targetSymbol = targetWord[index];

            // Find indexes where targetSymbol occurs
            const targetIndexes = symbols.map((s,i)=> s.textContent === targetSymbol ? i : -1).filter(i=>i>=0);

            let chosenIndex;
            if(wantWin){
                // ensure there is at least one occurrence; if not ‚Äî inject one at random position
                if(targetIndexes.length===0){
                    const insPos = Math.floor(Math.random()*symbols.length);
                    symbols[insPos].textContent = targetSymbol;
                    chosenIndex = insPos;
                }else{
                    chosenIndex = targetIndexes[Math.floor(Math.random()*targetIndexes.length)];
                }
            }else{
                // pick any index that is NOT the targetSymbol to avoid accidental win
                const nonTarget = symbols.map((s,i)=> s.textContent !== targetSymbol ? i : -1).filter(i=>i>=0);
                chosenIndex = nonTarget.length ? nonTarget[Math.floor(Math.random()*nonTarget.length)] : Math.floor(Math.random()*symbols.length);
            }

            // number of full rotations
            const spinsCount = 4 + Math.floor(Math.random()*3);
            const totalDistance = (spinsCount * symbols.length + chosenIndex) * symbolHeight;
            const startTime = performance.now();

            function animate(now){
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const y = -totalDistance * easeOut;
                reel.style.transform = `translateY(${y}px)`;

                if(progress < 1){
                    requestAnimationFrame(animate);
                }else{
                    // snap to exact position
                    const finalY = -chosenIndex * symbolHeight;
                    reel.style.transform = `translateY(${finalY}px)`;
                    // small timeout to allow UI update
                    setTimeout(()=>resolve(symbols[chosenIndex].textContent), 40);
                }
            }

            requestAnimationFrame(animate);
        });
    }

    async function spin(){
        if(spinning) return;
        spinning = true;
        spins++;
        updateStatsUI();
        spinButton.disabled = true; spinButton.setAttribute('aria-pressed','true');
        messageEl.textContent = 'üé∞ –ö—Ä—É—Ç–∏–º...';

        // clear highlights
        for(let i=0;i<REEL_COUNT;i++) document.getElementById(`highlight${i}`).classList.remove('active');

        const durations = [900,1100,1300,1500,1700,1900,2100];
        const promises = [];
        for(let i=0;i<REEL_COUNT;i++) promises.push(spinReel(i,durations[i]||1600));

        const results = await Promise.all(promises);

        // evaluate results
        let correctCount = 0;
        results.forEach((r,i)=>{
            if(r === targetWord[i]){ correctCount++; document.getElementById(`highlight${i}`).classList.add('active'); }
        });

        if(correctCount === REEL_COUNT){
            wins++; saveStats(); updateStatsUI();
            messageEl.textContent = 'üéâ –î–ñ–ï–ö–ü–û–¢! –í—ã —Å–æ–±—Ä–∞–ª–∏ –ù–ò–ö–ò–¢–ö–ê! üéâ';
            showWin(); createFireworks();
        }else if(correctCount >= 4){
            messageEl.textContent = `üî• –û—Ç–ª–∏—á–Ω–æ! ${correctCount} –∏–∑ ${REEL_COUNT} –±—É–∫–≤ –≤–µ—Ä–Ω—ã!`;
            saveStats(); updateStatsUI();
        }else if(correctCount >= 2){
            messageEl.textContent = `üòä –ù–µ–ø–ª–æ—Ö–æ! ${correctCount} –∏–∑ ${REEL_COUNT} –±—É–∫–≤.`;
            saveStats(); updateStatsUI();
        }else if(correctCount === 1){
            messageEl.textContent = 'üòê 1 –∏–∑ 7 –±—É–∫–≤—ã –≤–µ—Ä–Ω–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë.';
            saveStats(); updateStatsUI();
        }else{
            messageEl.textContent = 'üò¢ –ù–∏ –æ–¥–Ω–æ–π –±—É–∫–≤—ã ‚Äî –≤–µ–∑–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ.';
            saveStats(); updateStatsUI();
        }

        spinning = false; spinButton.disabled = false; spinButton.setAttribute('aria-pressed','false');
    }

    // keyboard support
    document.addEventListener('keydown',(e)=>{
        if(e.code==='Space' && !spinning){ e.preventDefault(); spin(); }
    });

    // WIN overlay
    function showWin(){ winOverlay.style.display = 'flex'; }
    closeWin.addEventListener('click', ()=>{ winOverlay.style.display='none'; });

    // simple fireworks (lightweight)
    function createFireworks(){
        const colors = ['#ff6b6b','#ffd700','#4ade80','#60a5fa','#a78bfa'];
        for(let i=0;i<6;i++){
            setTimeout(()=>{
                const x = Math.random()*window.innerWidth;
                const y = Math.random()*window.innerHeight*0.5;
                for(let p=0;p<24;p++){
                    const d = document.createElement('div');
                    d.className='fw';
                    d.style.position='absolute'; d.style.left=`${x}px`; d.style.top=`${y}px`;
                    d.style.width='6px'; d.style.height='6px'; d.style.borderRadius='50%';
                    d.style.background=colors[Math.floor(Math.random()*colors.length)];
                    d.style.opacity='0.95'; d.style.pointerEvents='none';
                    const angle=(Math.PI*2*p)/24; const v=60+Math.random()*120;
                    const tx=Math.cos(angle)*v; const ty=Math.sin(angle)*v;
                    d.animate([{transform:'translate(0px,0px)',opacity:1},{transform:`translate(${tx}px,${ty}px)`,opacity:0}],{duration:800,easing:'cubic-bezier(.2,.8,.2,1)'});
                    fireworksContainer.appendChild(d);
                    setTimeout(()=>d.remove(),900);
                }
            }, i*220);
        }
    }

    // theme toggle & persist
    function applyThemeFromStorage(){
        const t = localStorage.getItem('nikitka_theme');
        if(t==='light') document.body.classList.add('light-theme');
    }
    themeToggle.addEventListener('click', ()=>{
        document.body.classList.toggle('light-theme');
        localStorage.setItem('nikitka_theme', document.body.classList.contains('light-theme')?'light':'dark');
    });
    applyThemeFromStorage();

    // reset stats
    resetStats.addEventListener('click', ()=>{
        if(confirm('–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')){ spins=0;wins=0;saveStats();updateStatsUI(); }
    });

    // init
    // note: we keep initial reels static (generated at start) to give player sense of continuity
    // if you want completely random new symbols each spin, re-run populate

    // small polish: debounce resize to keep symbol height correct
    let resizeTimer; window.addEventListener('resize', ()=>{ clearTimeout(resizeTimer); resizeTimer=setTimeout(()=>{/* nothing for now, animations read symbol height dynamically */},200) });

</script>

</body>
</html>
